usethis::use_mit_license(copyright_holder = "Isak Roalkvam")
rrtools::use_readme_rmd()
rrtools::use_analysis()
renv::init()
library(tidyverse)
library(tidyverse)
renv::snapshot()
library(tidyverse)
library(sf)
library(terra)
library(here)
# For reproducibility
set.seed(1)
# Load data
surveyed <- st_read(here("analysis/data/raw_data/surveyed_sites.gpkg"))
excavated <- st_zm(read_sf(here("analysis/data/raw_data/excavated_sites.gpkg")))
dtm <- rast("/home/isak/phd/eaa_presentation/dtm10/dtm10.tif")
site_dat <- read.csv(here("analysis/data/raw_data/sites.csv"))
# Exclude sites that haven't been excavated and which haven't been shoreline
# dated
shore_sites <- site_dat %>% dplyr::filter(investigated == "t") %>%
dplyr::filter(dating_method == "shore_typo" & !is.na(reported_earliest_bce)
& !is.na(reported_min_elev))
# Join shoreline dated excavated sites with the spatial data for the sites
excshore <- st_as_sf(
dplyr::left_join(shore_sites, excavated,
by = c("name" = "site_name", "ask_id"))
) %>%
dplyr::filter(!(is.na(st_dimension(geom))))
# Find mean reported elevation for the excavated sites
excshore$elev <- rowMeans(subset(st_drop_geometry(excshore),
select = c(reported_min_elev,
reported_max_elev)))
# Find elevation of surveyed sites
surveyed$elev <- terra::extract(dtm, vect(surveyed), fun = mean)[, -1]
# Exclude surveyed sites with a quality score worse than 3
survq <- dplyr::filter(surveyed, quality < 4)
# Select and rename columns needed to perform shoreline dating
rcolexcshore <- excshore %>% dplyr::select(ask_id, elev)
rcolsurvq <- survq  %>% dplyr::select(askeladden_id, elev) %>%
dplyr::rename(ask_id = askeladden_id)
# Combine the data
sites <-rbind(rcolexcshore, rcolsurvq)
###### Shoreline dating ######
step_reso = 0.1
shorelinedates <- shoredate::shoreline_date(sites,
elev_raster = dtm,
elev_reso = step_reso,
cal_reso = 5,
sparse = TRUE,
verbose = TRUE)
devtools::install_github("isakro/shoredate")
library(shoredate)
step_reso
shorelinedates <- shoredate::shoreline_date(sites,
elev_raster = dtm,
elev_reso = step_reso,
cal_reso = 5,
sparse = TRUE,
verbose = TRUE)
shorelinedates <- shoredate::shoreline_date(sites,
elevation = dtm,
elev_reso = step_reso,
cal_reso = 5,
sparse = TRUE,
verbose = TRUE)
warnings()
# Younger date than 2500 BCE
outofbounds <- c(159969, 94301-1, 144111-1, 144113-1, 144114-1, 138457-1, 265781-0,
265784-0,
# Older date than 9460 BCE
158183-1, 171065-1, 171069-1, 220991-1, 244498-0, 250359-0, 262662-0,
270912-0, 270916-0, 274933-0, 276689-0, 287819-0)
length(outofbounds)
save(shorelinedates,
file = here("analysis/data/derived_data/sdates.RData"))
sumdates <- sum_shoredates(shorelinedates)
shoredate_sumplot(sumdates)
sumdates
remove.packages("shoredate")
devtools::install_github("isakro/shoredate")
library(shoredate)
sumdates <- sum_shoredates(shorelinedates)
shoredate_sumplot(sumdates)
sumdates
target_points <- sf::st_sfc(sf::st_point(c(538310, 6544255)),
sf::st_point(c(538300, 6544250)),
sf::st_point(c(538250, 6544250)))
target_points <- sf::st_set_crs(target_points, 32632)
# shoreline_date() gives an expected warning here, which is already tested in
# test-shoreline_date.R. This is therefore suppressed.
target_dates <- suppressWarnings(shoreline_date(sites = target_points,
elevation = c(46, 200, 100),
sparse = TRUE))
sum_shoredates(target_dates)
remove.packages("shoredate")
use renv::deactivate()
renv::deactivate()
remove.packages("shoredate")
devtools::install_github("isakro/shoredate")
library(shoredate)
sumdates <- sum_shoredates(shorelinedates)
sumdates
shoredate_sumplot(sumdates)
shoredate_sumplot(sumdates) + scale_x_continuous(limits = c(-10000, -2500))
sumdates
# Code repurposed from modelTest() from rcarbon
fit <- nls(y ~ (exp(a + b * x)),
data = data.frame(x = sumdates$bce, y = sumdates$prob_sum),
start = list(a = 0, b = 0))
sumdates$bce
class(sumdates)
sumdates[[1]]$bce
rbind(sumdates)
as.data.frame(sumdates)
sumdates <- as.data.frame(sumdates)
# Code repurposed from modelTest() from rcarbon
fit <- nls(y ~ (exp(a + b * x)),
data = data.frame(x = sumdates$bce, y = sumdates$prob_sum),
start = list(a = 0, b = 0))
sumdates$bce
sumdates
# Code repurposed from modelTest() from rcarbon
fit <- nls(y ~ (exp(a + b * x)),
data = data.frame(x = sumdates$sum.bce, y = sumdates$sum.prob_sum),
start = list(a = 0, b = 0))
sumdates$sum.prob_sum
names(sumdates)
# Code repurposed from modelTest() from rcarbon
fit <- nls(y ~ (exp(a + b * x)),
data = data.frame(x = sumdates$sum.bce, y = sumdates$sum.probability),
start = list(a = 0, b = 0))
est <- predict(fit, list(x = sumdates$bce))
est <- predict(fit, list(x = sumdates$sum.bce))
predgrid <- data.frame(bce = sumdates$sum.bce, prob_dens = est)
predgrid <- dplyr::filter(predgrid, bce >= lower_lim & bce <= upper_lim)
predgrid
load("analysis/data/derived_data/sdates.RData")
sumdates <- sum_shoredates(shorelinedates)
shoredate_sumplot(sumdates) + scale_x_continuous(limits = c(-10000, -2500))
sumdates
sumdates <- as.data.frame(sumdates)
sumdates <- as.data.frame(sumdates) %>%
filter(probability > 0)
sumdates <- as.data.frame(sumdates) %>%
filter(sum.probability > 0)
# Code repurposed from modelTest() from rcarbon
fit <- nls(y ~ (exp(a + b * x)),
data = data.frame(x = sumdates$sum.bce, y = sumdates$sum.probability),
start = list(a = 0, b = 0))
est <- predict(fit, list(x = sumdates$sum.bce))
predgrid <- data.frame(bce = sumdates$sum.bce, prob_dens = est)
predgrid <- dplyr::filter(predgrid, bce >= lower_lim & bce <= upper_lim)
predgrid
shoredate_sumplot(sumdates) +
geom_line(data = predgrid, aes(x = bce, y = prob_dens)) +
scale_x_continuous(breaks = seq(-10000, 2500, 500))
load("analysis/data/derived_data/sdates.RData")
sumdates <- sum_shoredates(shorelinedates)
sumdatesdf <- as.data.frame(sumdates) %>%
filter(sum.probability > 0)
# Code repurposed from modelTest() from rcarbon
fit <- nls(y ~ (exp(a + b * x)),
data = data.frame(x = sumdatesdf$sum.bce, y = sumdatesdf$sum.probability),
start = list(a = 0, b = 0))
est <- predict(fit, list(x = sumdatesdf$sum.bce))
predgrid <- data.frame(bce = sumdatesdf$sum.bce, prob_dens = est)
shoredate_sumplot(sumdates) +
geom_line(data = predgrid, aes(x = bce, y = prob_dens)) +
scale_x_continuous(breaks = seq(-10000, 2500, 500))
sumdatesdf <- as.data.frame(sumdates) %>%
filter(sum.probability > 0 & sum.bce <= -2500)
# Code repurposed from modelTest() from rcarbon
fit <- nls(y ~ (exp(a + b * x)),
data = data.frame(x = sumdatesdf$sum.bce, y = sumdatesdf$sum.probability),
start = list(a = 0, b = 0))
est <- predict(fit, list(x = sumdatesdf$sum.bce))
predgrid <- data.frame(bce = sumdatesdf$sum.bce, prob_dens = est)
shoredate_sumplot(sumdates) +
geom_line(data = predgrid, aes(x = bce, y = prob_dens)) +
scale_x_continuous(breaks = seq(-10000, 2500, 500))
?sum_shoredates
sumdates <- sum_shoredates(shorelinedates, cut_off_level = 0.5)
load("analysis/data/derived_data/sdates.RData")
sumdates <- sum_shoredates(shorelinedates, cut_off_level = 0.5)
remove.packages("shoredate")
devtools::install_github("isakro/shoredate")
library(shoredate)
load("analysis/data/derived_data/sdates.RData")
sumdates <- sum_shoredates(shorelinedates, cut_off_level = 0.5)
remove.packages("shoredate")
library(shoredate)
remove.packages("shoredate")
remove.packages("shoredate")
library(shoredate)
remove.packages("shoredate")
devtools::install_github("isakro/shoredate")
library(shoredate)
sumdates <- sum_shoredates(shorelinedates, cut_off_level = 0.5)
remove.packages("shoredate")
